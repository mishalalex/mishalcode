# MISHALCODE
------------

### Goal
--------
To create an online platform where users can solve coding challenges in different languages similar to leetcode or geeksforgeeks

### Technologies used
---------------------
### Backened - NodeJs, Express, Postgres, Prisma, Judge0
### Frontend - ReactJs, Tailwind-Css, DaisyUI, Zustand, Zod and React-Hook Forms

### API Architecture
--------------------
1. Authentication
2. Problem Management (CRUD operation related to the problem)
3. Code execution 
4. Submission
5. Playlist creation for a set of problems


### How does our platform operates
----------------------------------



### Steps followed
-------------------
1. folder -> mkdir backend frontend
2. file -> .gitignore
   1. added 'node_modules' and '.env' to this file
3. 'nodemmon' is installed universally via "npm i -g nodemon" command

Backend Folder
--------------
1. folder -> backend/src (here we will keep the backend code)
2. install express and dotenv packages
3. file -> backend/src/index.js
   1. setup a simple server using express and getting the port from dotenv file
4. prisma
   1. npm i prisma @prisma/client 
   2. npx prisma init (scaffolding prisma configurations are setup)
5. postgres
   1. we will run docker for postgres where the credentials are posted on environment vairable with port mapping to 5432 in detach mode
   2. docker command 'docker run --name my-postgres -e POSTGRES_USER=myuser -e POSTGRES_PASSWORD=mypassword -p 5432:5432 -d postgres'
   3. it will return a db connect url - "postgresql://myuser:mypassword@localhost:5432/postgres"
   4. update the database url in env file
6. folder -> src/libs
7. file -> src/libs/db.js (we will keep prisma client)
8. Update schema.prisma file with a db model
9. prisma commands to run 
   1.  npx generate prisma (update the db.js file with the prisma client setup code)
   2.  npx prisma migrate dev
   3.  npx prisma db push 
10. code the first route -> auth routes
    1.  folder -> src/routes -> file -> auth.routes.js
    2.  create an express routes -> const authRouter = express.Router()
    3.  create routes for register, login, logout and check like authRouter.post('/register', register) // 'register' in controller will be made in the second 
11. code the first controller -> auth controller
    1.  folder -> src/controllers -> file -> auth.controller.js
    2.  npm i bcryptjs
    3.  create controller for each routes like -> export const register = async (req, res) => {}
    4.  generate a 32 char random hex string using openssl command in bash -> "openssl rand -hex 32"
    5.  make an entry in the .env file the above random string as the JWT_SECRET
12. code the auth controller for register route
    1.  get the data from the request by destructuring the request body
    2.  in a try-catch block, check whethehr a user exists in the db with the given email
    3.  if yes, throw an error
    4.  if no, then continue by creating a hash for the password 
    5.  make a db entry with the request data including the hashed password
    6.  make a JWT token using user id (autogenerated as configured in the prisma), JWT_SECRET in env file and an expiresIn
    7.  configure cookie using cookie-parser library by app.use(cookieParser()) in index.js file
    8.  configure cookie to be sent in response in the auth controller in response using res.cookie("jwt", token, {<other details>})
    9.  test using api test runner whether it is working
13. code the auth controller for login route
    1.  get the data from the request by destructuring the request body
    2.  in a try-catch block: 
        1.  check whether the user exists in db with the given email, return error if doesn't
        2.  check whether the passwords match by comparing the hashed passwords using bcryptjs
        3.  once checked, create a JWT token to e sent to the user and return a 200 success response
14. code the auth controller for logout route
    1.  in a try-catch block:
        1.  delete the stored cookie using 'res.clearCookies' method
        2.  return a success message 
15. code the auth controller for check route
    1.  in a try-catch block:
        1.  return a success message that user has been authenticated successfully
16. write a middleware for authenticate user
    1.  get the jwt cookie from req.cookies.jwt
    2.  throw error if no token
    3.  decode the cookie using JWT_SECRET with jwt.verify("jwt",JWT_SECRET) method
    4.  throw error if decoding isn't successful
    5.  find the user from db from the id in the decoded cookie
    6.  throw error if no user found
    7.  if user found then add the user to the request by 'req.user = user' and call the next() method
17. create a new model problem
    1.  problem model is for problems which the user can solve
    2.  build a relation to user model with one user to many problem relationship that if a user is deleted, all the problems created by the user is also deleted
    3.  run prisma commands to set the db:
        1.  npx prisma generate
        2.  npx prisma migrate dev
        3.  npx prisma db push
18. install & setup judge0 using docker (can be skipped by using sulu judge0 api (third party api))
    1. install docker docker-compose docker.io
       1. sudo apt install docker docker-compose docker.io
    2. link to download: wget https://github.com/judge0/judge0/releases/download/v1.13.1/judge0-v1.13.1.zip
    3. cd to location -> unzip judge0-v1.13.1.zip 
    4. run -> docker-compose up -d db redis
    5. run -> docker-compose up -d (after ~ 10 sec) - it will take some time to download and setup for the first time
    6. once done, check whether it is working fine by going to -> http://localhost:2358/docs -> if you can see the docs for judge0 then everything is properly setup
 19. create problemRoutes and problemController
     1.  update index.js to add a new route to 'api/v1/problems' to add problem endpoints
     2.  create a new middleware to check whether the user has a role 'ADMIN' 
         1.  we can put after the 'authMiddleware' in our routes to restrict access to ADMIN only endpoints
     3.  file -> src/routes/problem.routes.js
     4.   add routes for the following (all of them requires the 'authMiddleware' check):
          1.   create a problem (admin)
          2.   get all problems
          3.   get all problems solved by user (user specific)
          4.   get problem by id
          5.   update a problem (admin)
          6.   delete a problem (admin)
     5.   file > src/controller/problem.controller.js
     6.   add scaffolding controllers for each of the above routes in problem
